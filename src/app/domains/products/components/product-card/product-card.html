<article class="product-item flex flex-col" [class.out-of-stock]="product().quantity <= 0">
  <div class="product-details flex align-start">
    <div class="product-category-icon">
        <i [class]="categoryIconClass()" aria-hidden="true"></i>
    </div>
    
    <div class="product-info-container flex-fill">
      <h2 class="product-name">
        @let name = product().productName.trim();
        @if (name) {
            {{ name }}
        } @else {
            <span class="product-name-placeholder">Sans nom</span>
        }
      </h2>
      <div class="product-info flex align-center">
        <p class="product-category">
          {{ product().category | titlecase }}
        </p>
        <p class="product-price ml-auto">
          {{ priceTtc() | currency:'EUR':'symbol':'1.2-2' }}
        </p>
      </div>
    </div>
  </div>

  @if (product().quantity > 0) {
    @if (availableQuantity() > 0) {
      <div class="add-to-cart flex align-center">
          <label [for]="'quantity-' + product().id">Quantité:</label>
          <select
            [id]="'quantity-' + product().id"
            [value]="effectiveQuantityToAdd()"
            aria-label="Quantité à ajouter"
            (change)="setQuantity($event)"
          >
            @for (quantity of quantityOptions; track quantity) {
              <option [value]="quantity">
                  {{ quantity }}
              </option>
            }
          </select>
          <button
            type="button"
            class="btn btn-primary"
            [attr.aria-label]="'Ajouter ' + (product().productName || 'cet article') + ' au panier'"
            (click)="addToCart()"
          >
            <i class="bi bi-bag-plus"></i>
            Ajouter
          </button>
      </div>
    } @else {
        <p class="product-stock-message">Tout est dans le panier</p>
    }
  } @else {
    <p class="product-stock-message">Non disponible</p>
  }
</article>